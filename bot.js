const Discord = require('discord.js');
const client = new Discord.Client();
const ayarlar = require('./ayarlar.json');
const chalk = require('chalk');
const fs = require('fs');
const { GOOGLE_API_KEY } = require('./anahtarlar.json');
const YouTube = require('simple-youtube-api');
const queue = new Map();  
const youtube = new YouTube(GOOGLE_API_KEY);
const ytdl = require('ytdl-core');
let xp = require("./xp.json");
const moment = require('moment');
const antispam = require("discord-anti-spam-tr");
require('./util/eventLoader')(client);

var prefix = ayarlar.prefix;

const log = message => {
  console.log(`[${moment().format('YYYY-MM-DD HH:mm:ss')}] ${message}`);
};

client.commands = new Discord.Collection();
client.aliases = new Discord.Collection();
fs.readdir('./komutlar/', (err, files) => {
  if (err) console.error(err);
  log(`${files.length} komut yÃ¼klenecek.`);
  files.forEach(f => {
    let props = require(`./komutlar/${f}`);
    log(`YÃ¼klenen komut: ${props.help.name}.`);
    client.commands.set(props.help.name, props);
    props.conf.aliases.forEach(alias => {
      client.aliases.set(alias, props.help.name);
    });
  });
});

client.reload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.load = command => {
  return new Promise((resolve, reject) => {
    try {
      let cmd = require(`./komutlar/${command}`);
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.unload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.on('guildMemberAdd', member => {
  member.addRole(member.guild.roles.find(r => r.name.startsWith('gelen-giden')));
  const channel = member.guild.channels.find('name', 'sayaÃ§-gelen-giden');
  if (!channel) return;
 const embed = new Discord.RichEmbed()
 .setColor('RANDOM')
 .setAuthor(member.user.tag, member.user.avatarURL || member.user.defaultAvatarURL)
 .setThumbnail(member.user.avatarURL || member.user.defaultAvatarURL)
 .setTitle('Ãœye katÄ±ldÄ± Ve Otomatik Rol Verildi;')
 .setDescription(`Sunucuya katÄ±ldÄ± Toplam [${member.guild.memberCount} Ã¼ye]!`)
 .setFooter('Rexo', client.user.avatarURL)
 .setTimestamp()
 channel.send(embed);
});


client.on('guildMemberRemove', member => {
  const channel = member.guild.channels.find('name', 'gelen-giden');
  if (!channel) return;
 const embed = new Discord.RichEmbed()
 .setColor('RANDOM')
 .setAuthor(member.user.tag, member.user.avatarURL || member.user.defaultAvatarURL)
 .setThumbnail(member.user.avatarURL || member.user.defaultAvatarURL)
 .setTitle('Ãœye ayrÄ±ldÄ±;')
 .setDescription(`Sunucudan ayrÄ±ldÄ± [${member.guild.memberCount} Ã¼ye]!`)
 .setFooter('Rexo', client.user.avatarURL)
 .setTimestamp()
 channel.send(embed);
});

client.on('message', msg => {
  const reason = msg.content.split(" ").slice(1).join(" ");
  if (msg.channel.name== 'canlÄ±-destek') { 
    const hatay = new Discord.RichEmbed()
    .addField(" Hata ", `Bu Sunucuda \`canlÄ±-destek\` AdÄ±nda Bir Rol Yok!`)
    .setColor("RANDOM")
    
    if (!msg.guild.roles.exists("name", "Destek")) return msg.author.send(hatay) + msg.guild.owner.send(`${msg.guild.name} AdlÄ± Sunucunda, \`Destek\` AdlÄ± Bir Rol OlmadÄ±ÄŸÄ± Ä°Ã§in, HiÃ§kimse Destek Talebi AÃ§amÄ±yor!`);
    if(msg.guild.channels.find('name', 'Talepler')) {
      msg.guild.createChannel(`destek-${msg.author.id}`, "text").then(c => {
      const category = msg.guild.channels.find('name', 'Talepler')
      c.setParent(category.id)
      let role = msg.guild.roles.find("name", "Destek");
      let role2 = msg.guild.roles.find("name", "@everyone");
      c.overwritePermissions(role, {
          SEND_MESSAGES: false,
          READ_MESSAGES: false
      });
      c.overwritePermissions(role2, {
          SEND_MESSAGES: false,
          READ_MESSAGES: false
      });
      c.overwritePermissions(msg.author, {
          SEND_MESSAGES: true,
          READ_MESSAGES: true
      });

      const embed = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setAuthor(`${client.user.username} | Destek Sistemi`)
      .addField(`Merhaba ${msg.author.username}!`, `Destek Yetkilileri burada seninle ilgilenecektir. \nDestek talebini kapatmak iÃ§in \`${prefix}d-kapat\` yazabilirsin.`)
      .addField(`Â» Talep Konusu/Sebebi:`, `${msg.content}`, true)
      .addField(`Â» KullanÄ±cÄ±:`, `<@${msg.author.id}>`, true)
      .setFooter(`${client.user.username} | Destek Sistemi`)
      .setTimestamp()
      c.send({ embed: embed });
      c.send(`<@${msg.author.id}> AdlÄ± kullanÄ±cÄ± "\`${msg.content}\`" sebebi ile destek talebi aÃ§tÄ±! LÃ¼tfen Destek Ekibini bekle, @here`)
      msg.delete()
      }).catch(console.error);
    }
  }
});
  
client.on("message", message => {
if (message.content.toLowerCase().startsWith(prefix + `d-kapat`)) {
    if (!message.channel.name.startsWith(`destek-`)) return message.channel.send(`Bu komut sadece Destek Talebi kanallarÄ±nda kullanÄ±labilir!`);

    var deneme = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setAuthor(`Destek Talebi Kapatma Ä°ÅŸlemi`)
    .setDescription(`Destek talebini kapatmayÄ± onaylamak iÃ§in, \n10 saniye iÃ§inde \`evet\` yazÄ±nÄ±z.`)
    .setFooter(`${client.user.username} | Destek Sistemi`)
    message.channel.send(deneme)
    .then((m) => {
      message.channel.awaitMessages(response => response.content === 'evet', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
      .then((collected) => {
          message.channel.delete();
        })
        .catch(() => {
          m.edit('Destek Talebi kapatma isteÄŸin zaman aÅŸÄ±mÄ±na uÄŸradÄ±!').then(m2 => {
              m2.delete();
          }, 3000);
        });
    });
}
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === prefix + 'temizle') {
    if (msg.channel.type === 'dm') {
      const ozelmesajuyari = new Discord.RichEmbed()
    .setColor(0xFF0000)
    .setTimestamp()
    .setAuthor(msg.author.username, msg.author.avatarURL)
    .addField(':warning: UyarÄ± :warning:', 'Bu komutu Ã¶zel mesajlarda kullanamazsÄ±n.')
    msg.author.sendEmbed(ozelmesajuyari); }
      if (msg.channel.type !== 'dm') {
        if (!msg.member.hasPermission("MANAGE_MESSAGES")) {
          if (msg.author.id !== ayarlar.yapimci) {
            const mesajlariyonet = new Discord.RichEmbed()
          .setColor(0xFF0000)
          .setTimestamp()
          .setAuthor(msg.author.username, msg.author.avatarURL)
          .addField(':warning: UyarÄ± :warning:', 'Bu komutu kulllanmak iÃ§in `MesajlarÄ± YÃ¶net` iznine sahip olmalÄ±sÄ±n.')
          return msg.author.sendEmbed(mesajlariyonet);
      }}
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100); //5000 mesaj gg
      const sohbetsilindi = new Discord.RichEmbed()
    .setColor(0x00AE86)
    .setTimestamp()
    .addField('Eylem:', 'Sohbet silme')
    .addField('Yetkili:', msg.author.username)
    .addField('SonuÃ§:', `BaÅŸarÄ±lÄ±`)
	.addField('Silinen Mesaj SayÄ±sÄ±:', '5000')
    return msg.channel.sendEmbed(sohbetsilindi);
      console.log("Sohbet " + msg.member + " tarafÄ±ndan silindi!");
}}});

var request = require('request');

request('https://api.eggsybot.xyz/espri', function (error, response, body) {
    if (error) return console.log('Hata:', error); // Hata olursa, konsola gÃ¶ndersin,
    else if (!error) { // EÄŸer hata yoksa;
        var info = JSON.parse(body); // info deÄŸiÅŸkeninin iÃ§erisine JSON'Ä± ayrÄ±ÅŸtÄ±rsÄ±n,
        console.log(info.soz); // ve konsola Ã§Ä±ktÄ±yÄ± versin.
    }
});


client.on('guildDelete', guild => {

let rrrsembed = new Discord.RichEmbed()

.setColor("RED")
.setTitle("<a:logout:508233230458028035> | Botumuzu Kickledi :( ")
.addField("Sunucu AdÄ±:", guild.name)
.addField("Sunucu sahibi", guild.owner)
.addField("Sunucu Sahibi'nin ID'si", guild.ownerID)
.addField("Sunucunun Kurulu OlduÄŸu BÃ¶lge:", guild.region)
.addField("Sunucudaki KiÅŸi SayÄ±sÄ±:", guild.memberCount)

   client.channels.get('548455190701932546').send(rrrsembed);
  
});


client.on("guildMemberAdd", async member => {
        let sayac = JSON.parse(fs.readFileSync("./otorol.json", "utf8"));
  let otorole =  JSON.parse(fs.readFileSync("./otorol.json", "utf8"));
      let arole = otorole[member.guild.id].sayi
  let giriscikis = JSON.parse(fs.readFileSync("./otorol.json", "utf8"));  
  let embed = new Discord.RichEmbed()
    .setTitle('Otorol Sistemi')
    .setDescription(`:loudspeaker: :inbox_tray:  @${member.user.tag}'a Otorol Verildi `)
.setColor("GREEN")
    .setFooter("Gnarge", client.user.avatarURL);

  if (!giriscikis[member.guild.id].kanal) {
    return;
  }

  try {
    let giriscikiskanalID = giriscikis[member.guild.id].kanal;
    let giriscikiskanali = client.guilds.get(member.guild.id).channels.get(giriscikiskanalID);
    giriscikiskanali.send(`:loudspeaker: :white_check_mark: HoÅŸgeldin **${member.user.tag}** RolÃ¼n BaÅŸarÄ±yla Verildi.`);
  } catch (e) { // eÄŸer hata olursa bu hatayÄ± Ã¶ÄŸrenmek iÃ§in hatayÄ± konsola gÃ¶nderelim.
    return console.log(e)
  }

});

client.on("guildMemberAdd", async (member) => {
      let autorole =  JSON.parse(fs.readFileSync("./otorol.json", "utf8"));
      let role = autorole[member.guild.id].sayi

      member.addRole(role)

});

client.on('message', async message => {
  const ms = require('ms');
  const args = message.content.slice(prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
  let u = message.mentions.users.first() || message.author;
  if (command === "sunucu-kur") {
  if (message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")) return message.channel.send(" Bot Paneli Zaten AyarlanmÄ±ÅŸ.")
  message.channel.send(`Bot Bilgi KanallarÄ±nÄ±n kurulumu baÅŸlatÄ±lsÄ±n mÄ±? baÅŸlatÄ±lacak ise **evet** yazÄ±nÄ±z.`)
      if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Bu Kodu `YÃ¶netici` Yetkisi Olan KiÅŸi Kullanabilir.");
      message.channel.awaitMessages(response => response.content === 'evet', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
    .then((collected) => {
   message.guild.createChannel('|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|', 'category', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])


   message.guild.createChannel('Talepler', 'category', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
        
 message.guild.createChannel('ã€ŒğŸ“ƒã€kurallar', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
 message.guild.createChannel('ã€ŒğŸšªã€gelen-giden', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
       channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
       message.guild.createChannel('ã€Œâœ…ã€sayaÃ§', 'text', [{
        id: message.guild.id,
        deny: ['SEND_MESSAGES']
      }])
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
             message.guild.createChannel('ã€ŒğŸ’¾ã€log-kanalÄ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
            .then(channel => channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
            message.guild.createChannel('ã€ŒğŸ“¢ã€duyuru-odasÄ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
        message.guild.createChannel('yetki-baÅŸvurusu', 'text', [{
        id: message.guild.id,
        deny: ['SEND_MESSAGES']
      }])
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));

       }) 
       .then((collected) => {
        message.guild.createChannel('|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|', 'category', [{
       id: message.guild.id,
     }]);
	  message.guild.createChannel(`canlÄ±-destek`)
	 .then(channel =>
	 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
      message.guild.createChannel(`ã€ŒğŸ’¡ã€ÅŸikayet-ve-Ã¶neri`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒğŸ‘¥ã€pre-arama-odasÄ±`, 'text')
     .then(channel =>
            channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒğŸ“·ã€gÃ¶rsel-iÃ§erik`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒğŸ¤–ã€bot-komutlarÄ±`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒğŸ’¬ã€sohbet`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));

      message.guild.createChannel(`ğŸ†ã€‹Kurucu OdasÄ±`, "voice")
      .then(channel =>
        channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
      .then(c => {
        let role = message.guild.roles.find("name", "@everyone");
        let role2 = message.guild.roles.find("name", "Kurucu");
        
        c.overwritePermissions(role, {
            CONNECT: false,
        });
        c.overwritePermissions(role2, {
            CONNECT: true,
            
        });
    })

    message.guild.createChannel('|â–¬â–¬|SES KANALLARI|â–¬â–¬|', 'category', [{
      id: message.guild.id,
    }]);

    message.guild.createChannel(`ğŸ†ã€‹YÃ¶netici OdasÄ±`, "voice")
    .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
    .then(c => {
      let role = message.guild.roles.find("name", "@everyone");
      let role2 = message.guild.roles.find("name", "Kurucu");
      let role3 = message.guild.roles.find("name", "YÃ¶netici");
      c.overwritePermissions(role, {
          CONNECT: false,
      });
      c.overwritePermissions(role2, {
          CONNECT: true,
      });
      c.overwritePermissions(role3, {
          CONNECT: true,
      });
  })

  message.guild.createChannel(`ğŸ’¬ã€‹Sohbet OdasÄ±`, "voice")
  .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
  .then(c => {
    let role = message.guild.roles.find("name", "@everyone");
    c.overwritePermissions(role, {
        CONNECT: true,
    });
})

message.guild.createChannel('|â–¬â–¬|OYUN ODALARI|â–¬â–¬|', 'category', [{
  id: message.guild.id,
}]);

message.guild.createChannel(`ğŸ®ã€‹LOL`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ğŸ®ã€‹ZULA`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ğŸ®ã€‹COUNTER STRÄ°KE`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ğŸ®ã€‹PUBG`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
  message.guild.createChannel(`ğŸ®ã€‹FORTNÄ°TE`, 'voice')
  .then(channel =>
   channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
   message.guild.createChannel(`ğŸ®ã€‹MÄ°NECRAFT`, 'voice')
   .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
    message.guild.createChannel(`ğŸ®ã€‹ROBLOX`, 'voice')
    .then(channel =>
     channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
     message.guild.createChannel(`ğŸ®ã€‹WOLFTEAM`, 'voice')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))



      message.guild.createRole({
        name: 'Kurucu',
        color: 'RED',
        permissions: [
            "ADMINISTRATOR",
    ]
      })

      
      message.guild.createRole({
        name: 'YÃ¶netici',
        color: 'BLUE',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES",
            "KICK_MEMBERS"
    ]
      })

      message.guild.createRole({
        name: 'ModeratÃ¶r',
        color: 'GREEN',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES"
    ]
      })

      message.guild.createRole({
        name: 'V.I.P',
        color: '00ffff',
      })

      message.guild.createRole({
        name: 'Ãœye',
        color: 'WHITE',
      })
	  
	  message.guild.createRole({
        name: 'Destek',
        color: '00999ff',
      })

      message.guild.createRole({
        name: 'Bot',
        color: 'ORANGE',
      })

       message.channel.send("Gerekli Odalar Kuruldu!")
     
            })   
    
}
});

const girismesaj = [
  '**Cait Army sunucunuza eklendi!**',
  '**Cait Army** sunucunuzdaki insanlara kolaylÄ±klar saÄŸlar.',
  'Botumuzun Ã¶zelliklerini Ã¶ÄŸrenmek iÃ§in !yardÄ±m komutunu kullanabilirsin.',
  '**Ã–NEMLÄ°:** Botun kullanmasÄ± iÃ§in mod-log kanalÄ± aÃ§Ä±n ve deneme iÃ§in',
  'birine ban atÄ±n ya da bir banlÄ± kiÅŸinin banÄ±nÄ± kaldÄ±rÄ±n.',
  '',
]

client.on('guildCreate', guild => {
    const generalChannel = guild.defaultChannel
    generalChannel.sendMessage(girismesaj)
})

client.on('guildCreate', guild => {
    let channel = client.channels.get("462353510801997845")
        const embed = new Discord.RichEmbed()
        .setColor("GREEN")
        .setAuthor(`GIRIS YAPTIM`)
        .setThumbnail(guild.iconURL)
        .addField("Sunucu", guild.name)
        .addField("Kurucu", guild.owner)
        .addField("Sunucu ID", guild.id, true)
        .addField("Toplam KullanÄ±cÄ±", guild.memberCount, true)
        .addField("Toplam Kanal", guild.channels.size, true)
         channel.send(embed);
    });

// Sunucuya birisi girdiÄŸi zaman mesajÄ± yolluyalÄ±m


client.on("message", async message => {
    let sayac = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
    if(sayac[message.guild.id]) {
        if(sayac[message.guild.id].sayi <= message.guild.members.size) {
            const embed = new Discord.RichEmbed()
                .setDescription(`Tebrikler ${message.guild.name}! BaÅŸarÄ±yla ${sayac[message.guild.id].sayi} kullanÄ±cÄ±ya ulaÅŸtÄ±k! SayaÃ§ sÄ±fÄ±rlandÄ±!`)
                .setColor("RANDOM")
                .setTimestamp()
            message.channel.send({embed})
            delete sayac[message.guild.id].sayi;
            delete sayac[message.guild.id];
            fs.writeFile("./ayarlar/sayac.json", JSON.stringify(sayac), (err) => {
                console.log(err)
            })
        }
    }
})

// Sunucuya birisi girdiÄŸi zaman mesajÄ± yolluyalÄ±m


client.on("guildMemberRemove", async member => {
        let sayac = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
  let giriscikis = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));  
  let embed = new Discord.RichEmbed()
    .setTitle('SayaÃ§ Sistemi')
    .setDescription(`:outbox_tray: GÃ¼le GÃ¼le :outbox_tray: \nâ•”â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬SayaÃ§â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\nâ•‘â–º             ${member.user.tag}\nâ•‘â–º KullanÄ±cÄ± AyrÄ±ldÄ± \nâ•‘â–º **${sayac[member.guild.id].sayi}** KiÅŸi OlmamÄ±za â¡ï¸ **${sayac[member.guild.id].sayi - member.guild.memberCount}** â¬…ï¸ KiÅŸi KaldÄ±\nâ•‘â–º Senin AyrÄ±lmanla Beraber **${member.guild.memberCount}**  KiÅŸiyiz! :outbox_tray:\nâ•šâ–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬`)
 .setColor("RED")
    .setFooter("Bot", client.user.avatarURL);

  if (!giriscikis[member.guild.id].kanal) {
    return;
  }

  try {
    let giriscikiskanalID = giriscikis[member.guild.id].kanal;
    let giriscikiskanali = client.guilds.get(member.guild.id).channels.get(giriscikiskanalID);
    giriscikiskanali.send(embed);
  } catch (e) { // eÄŸer hata olursa bu hatayÄ± Ã¶ÄŸrenmek iÃ§in hatayÄ± konsola gÃ¶nderelim.
    return console.log(e)
  }

});

//KullanÄ±cÄ± sunucudan ayrÄ±ldÄ±ÄŸÄ±nda ayarlanan kanala mesaj gÃ¶nderelim.
client.on("guildMemberAdd", async (member) => {
      let sayac = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
      let giriscikis = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
      let autorole =  JSON.parse(fs.readFileSync("./autorole.json", "utf8"));
      let role = autorole[member.guild.id].otorol

      member.addRole(role)

  let embed = new Discord.RichEmbed()
    .setTitle('SayaÃ§ Sistemi')
    .setDescription(`:inbox_tray: HoÅŸ Geldin :inbox_tray: \nâ•”â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬SayaÃ§â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\nâ•‘â–º             ${member.user.tag}\nâ•‘â–º KullanÄ±cÄ± KatÄ±ldÄ± \nâ•‘â–º **${sayac[member.guild.id].sayi}** KiÅŸi OlmamÄ±za â¡ï¸ **${sayac[member.guild.id].sayi - member.guild.memberCount}** â¬…ï¸ KiÅŸi KaldÄ±\nâ•‘â–º Senin KatÄ±lmanla Beraber **${member.guild.memberCount}**  KiÅŸiyiz! :inbox_tray:\nâ•šâ–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬`)
    .setColor("GREEN")
    .setFooter("Bot", client.user.avatarURL);

  if (!giriscikis[member.guild.id].kanal) {
    return;
  }

  try {
    let giriscikiskanalID = giriscikis[member.guild.id].kanal;
    let welcomechannel = client.guilds.get(member.guild.id).channels.get(giriscikiskanalID);
    welcomechannel.send(embed);
  } catch (e) { // eÄŸer hata olursa bu hatayÄ± Ã¶ÄŸrenmek iÃ§in hatayÄ± konsola gÃ¶nderelim.
    return console.log(e)
  }
});

client.on("message", async message => {
  if(message.author.bot) return;
  if(message.content.indexOf(prefix) !== 0) return;
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
    if (command === "espri") {
    
    var request = require('request');
    request('https://api.eggsybot.xyz/espri', function (error, response, body) {
    if (error) return console.log('Hata:', error); // Hata olursa, konsola gÃ¶ndersin,
    else if (!error) { // EÄŸer hata yoksa;
        var info = JSON.parse(body); // info deÄŸiÅŸkeninin iÃ§erisine JSON'Ä± ayrÄ±ÅŸtÄ±rsÄ±n,
        message.channel.send('' + info.soz); // ve konsola Ã§Ä±ktÄ±yÄ± versin.
    }
});    
}
});

client.on("message", async message => {
  if(message.author.bot) return;
  if(message.content.indexOf(prefix) !== 0) return;
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
    if (command === "sÃ¶z") {
    
    var request = require('request');
    request('https://simsekapi.glitch.me/soz', function (error, response, body) {
    if (error) return console.log('Hata:', error); // Hata olursa, konsola gÃ¶ndersin,
    else if (!error) { // EÄŸer hata yoksa;
        var info = JSON.parse(body); // info deÄŸiÅŸkeninin iÃ§erisine JSON'Ä± ayrÄ±ÅŸtÄ±rsÄ±n,
        message.channel.send('' + info.soz); // ve konsola Ã§Ä±ktÄ±yÄ± versin.
    }
});    
}
});

client.on("message", async message => {
  if(message.author.bot) return;
  if(message.content.indexOf(prefix) !== 0) return;
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
    if (command === "atatÃ¼rk") {
    
    var request = require('request');
    request('https://simsekapi.glitch.me/ataturk', function (error, response, body) {
    if (error) return console.log('Hata:', error); // Hata olursa, konsola gÃ¶ndersin,
    else if (!error) { // EÄŸer hata yoksa;
        var info = JSON.parse(body); // info deÄŸiÅŸkeninin iÃ§erisine JSON'Ä± ayrÄ±ÅŸtÄ±rsÄ±n,
        message.channel.send('' + info.ataturk); // ve konsola Ã§Ä±ktÄ±yÄ± versin.
    }
});    
}
});

client.on("message", async message => {
  if(message.author.bot) return;
  if(message.content.indexOf(prefix) !== 0) return;
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
    if (command === "vur") {
    
    var request = require('request');
    request('https://simsekapi.glitch.me/vur', function (error, response, body) {
    if (error) return console.log('Hata:', error); // Hata olursa, konsola gÃ¶ndersin,
    else if (!error) { // EÄŸer hata yoksa;
        var info = JSON.parse(body); // info deÄŸiÅŸkeninin iÃ§erisine JSON'Ä± ayrÄ±ÅŸtÄ±rsÄ±n,
        message.channel.send('' + info.vur); // ve konsola Ã§Ä±ktÄ±yÄ± versin.
    }
});    
}
});

client.on("message", async message => {
    const args = message.content.substring(prefix.length).split(" ");
    const command = args.shift().toLowerCase();
    if (command === "vaporwave") {
        const mapping = 'Â¡"#$%â…‹,)(*+\'-Ë™/0Æ–á„…Æã„£Ï›9ã„¥86:;<=>Â¿@ï¼¡ï¼¢ï¼£ï¼¤ï¼¥ï¼¦ï¼§ï¼¨ï¼©ï¼ªï¼«ï¼¬ï¼­ï¼®ï¼¯ï¼°ï¼±ï¼²ï¼³ï¼´ï¼µï¼¶ï¼·ï¼¸ï¼¹ï¼º[/]^_`ï½ï½‚ï½ƒï½„ï½…ï½†ï½‡ï½ˆï½‰ï½Šï½‹ï½Œï½ï½ï½ï½ï½‘ï½’ï½“ï½”ï½•ï½–ï½—ï½˜ï½™ï½š{|}~';
        const OFFSET = '!'.charCodeAt(0);
        if (args.length < 1) {
            message.channel.send(':warning: | Åekilli YazdÄ±rmanÄ± Ä°stediÄŸin ``YazÄ±yÄ±/Metini`` YazmadÄ±n.');
        }

        message.channel.send(
            args.join(' ').split('')
            .map(c => c.charCodeAt(0) - OFFSET)
            .map(c => mapping[c] || ' ')
            .join('')
        )
    }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'sa') {
    setTimeout(() => {
	msg.react('ğŸ‡¦');
	},500);
	setTimeout(() => {
	msg.react('ğŸ‡¸');
	},1000);
	setTimeout(() => {
	msg.react('ğŸ‡¹ğŸ‡·');
	},1500);
  };

  if (msg.author.bot) return;
  if (msg.content.toLowerCase().includes('herkese gÃ¼naydÄ±n')) msg.reply('**GÃœNAYDIN GÃ¼zel KardeÅŸim Bak Ne GÃ¼zel YaÅŸÄ±yorsun ÅÃ¼kÃ¼r Et ** :)');
  if (msg.content.toLowerCase().includes('iyi geceler')) msg.reply('**SAHÄ°DEN Ä°YÄ° MÄ° GECELER ?**');
  if (msg.content.toLowerCase().includes('iyi akÅŸamlar')) msg.reply('**EYV. Ä°YÄ° AKÅAMLAR**');
  if (msg.content.toLowerCase().includes('selamÄ±n aleykÃ¼m')) msg.reply('**ALEYKÃœM SELAM HOÅGELDÄ°N YÄ°ÄÄ°DO**');
  if (msg.content.toLowerCase().includes('gÃ¼le gÃ¼le')) msg.reply('**GÃœLE GÃœLE CÄ°ÄERÄ°M**');
  if (msg.content.toLowerCase().includes('canÄ±m sÄ±kkÄ±n')) msg.reply('** :smoking: HayÄ±rdÄ±r Be Moruk Kim SÄ±ktÄ± CanÄ±nÄ± Biz BurdayÄ±z Anlat**');
})

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'selam') {
    setTimeout(() => {
	msg.react('ğŸ‡¦');
	},500);
	setTimeout(() => {
	msg.react('ğŸ‡¸');
	},1000);
	setTimeout(() => {
	msg.react('ğŸ‡¹ğŸ‡·');
	},1500);
  };

  if (msg.author.bot) return;
  if (msg.content.toLowerCase().includes('amk')) msg.reply('**KÃ¼fÃ¼r Etme :rage:** :)');
})

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'Sa') {
    setTimeout(() => {
	msg.react('ğŸ‡¦');
	},500);
	setTimeout(() => {
	msg.react('ğŸ‡¸');
	},1000);
	setTimeout(() => {
	msg.react('ğŸ‡¹ğŸ‡·');
	},1500);
  };

  if (msg.author.bot) return;
})

const snekfetch = require('snekfetch');
let points = JSON.parse(fs.readFileSync('./xp.json', 'utf8'));

var f = [];
function factorial (n) {
  if (n == 0 || n == 1)
    return 1;
  if (f[n] > 0)
    return f[n];
  return f[n] = factorial(n-1) * n;
};
function clean(text) {
  if (typeof(text) === "string")
    return text.replace(/`/g, "`" + String.fromCharCode(8203)).replace(/@/g, "@" + String.fromCharCode(8203));
  else
      return text;
}



client.on("message", async message => {
    if (message.channel.type === "dm") return;

  if (message.author.bot) return;

  var user = message.mentions.users.first() || message.author;
  if (!message.guild) user = message.author;

  if (!points[user.id]) points[user.id] = {
    points: 0,
    level: 0,
  };

  let userData = points[user.id];
  userData.points++;

  let curLevel = Math.floor(0.1 * Math.sqrt(userData.points));
  if (curLevel > userData.level) {
    userData.level = curLevel;
        var user = message.mentions.users.first() || message.author;
message.channel.send(`ğŸ†™ **| ${user.username} Tebrikler Dostum! Level atladÄ±n**`)
    }

fs.writeFile('./xp.json', JSON.stringify(points), (err) => {
    if (err) console.error(err)
  })

  if (message.content.toLowerCase() === prefix + 'level' || message.content.toLowerCase() === prefix + 'profil') {
const level = new Discord.RichEmbed().setTitle(`${user.username}`).setDescription(`**Seviye:** ${userData.level}\n**EXP:** ${userData.points}`).setColor("RANDOM").setFooter(``).setThumbnail(user.avatarURL)
message.channel.send(`ğŸ“ **| ${user.username} AdlÄ± KullanÄ±cÄ±nÄ±n Profili Burada!**`)
message.channel.send(level)
  }
});


client.on('message', msg => {
  if (msg.content.toLowerCase () === "sa") {
        msg.react("500733858858139668")
  }
  if (msg.content.toLowerCase() === 'sa') {
        msg.reply('AleykÃ¼m selam, hoÅŸ geldin :heart: ');
  }
  if (msg.content.toLowerCase() === 'bb') {
      msg.reply('BayBay Kendine Ä°yi Bak');
  }
  if (msg.content.toLowerCase() === 'sende') {
      msg.reply('Eyvallah :wink: ');
  }
});

client.elevation = message => {
  if(!message.guild) {
	return; }
  let permlvl = 0;
  if (message.member.hasPermission("MANAGE_MESSAGES")) permlvl = 1;
  if (message.member.hasPermission("BAN_MEMBERS")) permlvl = 2;
  if (message.member.hasPermission("ADMINISTRATOR")) permlvl = 3;
  if (message.author.id === ayarlar.sahip) permlvl = 4;
  return permlvl;
};

var regToken = /[\w\d]{24}\.[\w\d]{6}\.[\w\d-_]{27}/g;
// client.on('debug', e => {
//   console.log(chalk.bgBlue.green(e.replace(regToken, 'that was redacted')));
// });

client.on('warn', e => {
  console.log(chalk.bgYellow(e.replace(regToken, 'that was redacted')));
});

client.on('error', e => {
  console.log(chalk.bgRed(e.replace(regToken, 'that was redacted')));
});


client.login(process.env.BOT_TOKEN);
